<div class="container mt-5">
  <div class="card shadow-lg">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Profilo Utente</h4>
      <button class="btn btn-sm btn-primary" (click)="toggleEdit()">
        {{ isEditing ? 'Salva' : 'Modifica' }}
      </button>
    </div>

    <div class="card-body">
      @if (utente) {
      <form (ngSubmit)="saveChanges()">

        <!-- Nome e Cognome -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Nome</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="utente.firstName"
              name="firstName"
              [readonly]="true" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Cognome</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="utente.lastName"
              name="lastName"
              [readonly]="true" />
          </div>
        </div>

        <!-- Username ed Email -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Username</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="utente.username"
              name="username"
              [readonly]="!isEditing" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="utente.email"
              name="email"
              [readonly]="true" />
          </div>
        </div>

        <!-- Data di nascita e Ruolo -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Data di nascita</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="utente.birthDate"
              name="birthDate"
              [readonly]="!isEditing" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Ruolo</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="utente.role"
              name="role"
              [readonly]="true" />
          </div>
        </div>

        <!-- Stato e Crediti -->
        <!-- <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Stato</label>
            <select
              class="form-select"
              [(ngModel)]="utente.state"
              name="state"
              [disabled]="true">
              <option [ngValue]="true">Attivo</option>
              <option [ngValue]="false">Disabilitato</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Crediti</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="utente.credits"
              name="credits"
              [readonly]="true" />
          </div>
        </div> -->
        <div class="row">
           <div class="col-md-6">
            <label class="form-label">Livello</label>
            <select
              class="form-select"
              [(ngModel)]="utente.userLevel"
              name="userLevel"
              name="state"
              [disabled]="!isEditing">
              <option [ngValue]="'BEGINNER'">Base</option>
              <option [ngValue]="'INTERMEDIATE'">Intermedio</option>
              <option [ngValue]="'ADVANCED'">Esperto</option>
            </select>
          </div>
        </div>

        <!-- Pulsanti azione -->
        @if (isEditing) {
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Annulla</button>
          <button type="submit" class="btn btn-success">Salva</button>
        </div>
        }

      </form>
      }
    </div>
  </div>
  <div class="card mt-4 shadow-lg">
    @if(isUploading){
      <div class="text-center mt-2 text-secondary">
      <i class="bi bi-arrow-repeat spin"></i> Upload in corso...
    </div>
    }
    <div *ngIf="isUploading" class="text-center mt-2 text-secondary">
      <i class="bi bi-arrow-repeat spin"></i> Upload in corso...
    </div>
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Documenti</h4>
      <div>
        <label for="document-upload" class="btn btn-sm btn-success mb-0">
          <i class="bi bi-upload"></i> Carica Documento
        </label>
        <!-- Aggiungi (change)="onFileSelected($event)" per gestire il file selezionato nel component -->
        <input
          id="document-upload"
          type="file"
          accept=".pdf,image/*"
          class="d-none"
          (change)="onFileSelected($event)"
        >
      </div>
    </div>
    <div class="card-body">
  @if (documents && documents.length > 0) {
    <ul class="list-group list-group-flush">
      <!-- {{ documents | json }} -->
      @for (doc of documents; track doc) {
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <i
              class="bi"
              [ngClass]="{
                'bi-file-earmark-pdf text-danger': doc.contentType === 'application/pdf',
                'bi-file-earmark-image text-primary': doc.contentType?.startsWith('image/')
              }"
            ></i>
            <span>{{ doc.fileName }}</span>
          </div>
          <button
            class="btn btn-sm btn-outline-danger"
            (click)="deleteDocument(doc.id)"
            title="Elimina documento"
          >
            <i class="bi bi-trash"></i>
          </button>
        </li>
      }
    </ul>
  } @else {
    <p class="text-muted text-center mb-0">Nessun documento caricato.</p>
  }
</div>


  </div>
</div>
